<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>PetaVision: OS X Installation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
</script>
<link rel="search" href="search-opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="PetaVision"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PetaVision
   &#160;<span id="projectnumber">Alpha</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.php" method="get">
              <img id="MSearchSelect" src="search/mag.png" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_src_install_osx.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">OS X Installation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is a tutorial on getting PetaVision installed and running on OS X, assuming you have a clean installation of OS X. You will need an admin account (for installing packages with sudo). Tested on OS X 10.9.5 (Mavericks). If you have an NVIDIA card, upgrading to Yosemite currently creates issues with cuDNN that are fixed by reinstalling cuDNN.</p>
<h2>Requirements </h2>
<ul>
<li>OS X</li>
<li>sudo access</li>
</ul>
<h2>Required installations </h2>
<ul>
<li>Xcode and Xcode command line tools</li>
<li>Homebrew</li>
<li>GDAL</li>
<li>OpenMPI</li>
</ul>
<h2>Optional installations </h2>
<ul>
<li>CUDA and cuDNN (to take advantage of CUDA GPU acceleration)</li>
<li>A C/C++ compiler with OpenMP capabilities (to take advantage of OpenMP parallelization)</li>
<li>Octave (to use the m-files in the mlab directory for analysis)</li>
</ul>
<h2>Xcode </h2>
<p>Xcode is needed by homebrew and gcc/g++/clang. Here's how to get it.</p><ul>
<li>Go to the Apple App Store and search for Xcode</li>
<li>Click 'GET', then 'INSTALL'. Put in your Apple ID information</li>
<li>After it's installed, we need to accept the Xcode license.<ul>
<li>Run the Xcode application</li>
<li>Follow the onscreen prompt until you see the main Xcode screen</li>
<li>Exit Xcode</li>
</ul>
</li>
<li>We also need command line tools for Xcode<ul>
<li>Go into a terminal and execute the following command</li>
</ul>
</li>
</ul>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;xcode-select --install</div>
</div><!-- fragment --><ul>
<li>Follow the onscreen prompt to install command line tools.</li>
</ul>
<h2>Homebrew </h2>
<p>Homebrew is a package manager for OS X, which we will use to install all of PetaVision's dependencies. Additional information can be found at <a href="http://brew.sh">http://brew.sh</a> To install homebrew:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</div>
</div><!-- fragment --><h2>Initialization </h2>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;brew update</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;brew install svn</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;brew install cmake</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;brew install wget</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;# optionally, to install Octave using homebrew:</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;brew tap homebrew/science</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;brew install octave</div>
</div><!-- fragment --><h2>Clang + OMP (optional) </h2>
<p>Currently (OS X Yosemite), the version of Clang installed by Xcode does not support OpenMP. The program installed as gcc is also Clang, not GNU-GCC (as can be verified by running gcc &ndash;version). To make use of the OpenMP threading in PetaVision you will need an OpenMP compatible compiler. Here are instructions to download a different version of clang and replace the current clang.</p>
<h3>Replace OS X default clang with clang+omp</h3>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;cd ${HOME}</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;mkdir clang-omp</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;cd clang-omp</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;git clone https://github.com/clang-omp/llvm</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;git clone https://github.com/clang-omp/compiler-rt llvm/projects/compiler-rt</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;git clone -b clang-omp https://github.com/clang-omp/clang llvm/tools/clang</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;mkdir build</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;cd build</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;../llvm/configure --enable-optimized</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;make -j8</div>
</div><!-- fragment --><p>Open your <code>~/.bash_profile</code> (or <code>~/.profile</code>, whichever one you use) and append these lines to the end of the file, making sure the clang-omp path is before <code>/usr/bin</code></p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;export PATH=~/clang-omp/build/Release+Asserts/bin:$PATH </div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;export C_INCLUDE_PATH=~/clang-omp/build/Release+Asserts/include:$C_INCLUDE_PATH</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;export CPLUS_INCLUDE_PATH=~/clang-omp/build/Release+Asserts/include:$CPLUS_INCLUDE_PATH</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;export LIBRARY_PATH=~/clang-omp/build/Release+Asserts/lib:$LIBRARY_PATH</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;export DYLD_LIBRARY_PATH=~/clang-omp/build/Release+Asserts/lib:$DYLD_LIBRARY_PATH</div>
</div><!-- fragment --><p>In any open terminals, run <code>source ~/.bash_profile</code>. Run <code>which clang</code> to verify that it's pointing to <code>${HOME}/clang-omp/build/Release_Asserts/bin/clang</code>.</p>
<h3>Install the openmp runtime library</h3>
<p>Releases can be found at <a href="https://www.openmprtl.org/download#stable-releases">https://www.openmprtl.org/download#stable-releases</a></p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;mv ~/Downloads/name_of_openmp_runtime_library.tar ~/clang-omp</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;cd ~/clang-omp</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;tar -xvf name_of_openmp_runtime_library.tar</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;cd libomp_oss</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;cmake CMakeLists.txt</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;make -j8</div>
</div><!-- fragment --><p>Once again, append these lines to the end of your <code>~/.bash_profile</code>.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;export C_INCLUDE_PATH=~/clang-omp/libomp_oss:$C_INCLUDE_PATH</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;export CPLUS_INCLUDE_PATH=~/clang-omp/libomp_oss:$CPLUS_INCLUDE_PATH</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;export LIBRARY_PATH=~/clang-omp/libomp_oss:$LIBRARY_PATH</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;export DYLD_LIBRARY_PATH=~/clang-omp/libomp_oss:$DYLD_LIBRARY_PATH</div>
</div><!-- fragment --><p>Make sure to run <code>source ~/.bash_profile</code>.</p>
<h2>OpenMPI </h2>
<p>With the new version of Clang installed, we can now install Open MPI using the new Clang.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;brew install gcc --without-multilib</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;brew install openmpi</div>
</div><!-- fragment --><p><em>Note</em>: Installing GCC can take a couple of hours. You need to use the '&ndash;without-multilib' flag or Homebrew will issue the caveat:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;GCC has been built with multilib support. Notably, OpenMP may not work:</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  https://gcc.gnu.org/bugzilla/show_bug.cgi?id=60670</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;If you need OpenMP support you may want to</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  brew reinstall gcc --without-multilib</div>
</div><!-- fragment --><h2>GDAL </h2>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;brew install gdal</div>
</div><!-- fragment --><h2>CUDA and NVIDIA Driver (optional): </h2>
<p>To take advantage of CUDA/cuDNN GPU acceleration your Macintosh needs to have an NVIDIA card with compute capabilities 3.0 or above. To find which video card you have, go to "About This Mac" under the Apple menu, select "System Report..." and then Graphics/Displays in the Hardware section. Check at <a href="https://developer.nvidia.com/cuda-gpus">https://developer.nvidia.com/cuda-gpus</a> to see if your video card supports CUDA. NVIDIA drivers are included with the cuda download. To install cuda:</p><ul>
<li>Go to <a href="https://developer.nvidia.com/cuda-downloads">https://developer.nvidia.com/cuda-downloads</a></li>
<li>Select Mac OS X and download the pkg provided</li>
<li>Follow the onscreen instructions. Make sure to select cuda driver and cuda toolkit.</li>
</ul>
<h2>CUDNN (optional) </h2>
<p>Go to <a href="https://developer.nvidia.com/cuDNN">https://developer.nvidia.com/cuDNN</a> and click Download at the bottom. Register with NVIDIA developers if need be, and wait for confirmation. Download the OS X version of CUDNN (Optional: if you have access to NMC's compuneuro, grab it from here: <code>/nh/compneuro/Data/cuDNN</code>)</p>
<h2>Checking Out and Installing PetaVision: </h2>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;cd ${HOME}</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;mkdir workspace</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;cd workspace</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;svn co https://&lt;useranme&gt;@svn.code.sf.net/p/petavision/code/trunk PetaVision</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;svn co https://&lt;username&gt;@svn.code.sf.net/p/petavision/code/PVSystemTests PVSystemTests</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;#You can download your sandbox here</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;cp PetaVision/docs/cmake/CMakeLists.txt .</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;#Here, you would add your sandbox to the end of CMakeLists.txt</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;ccmake .</div>
</div><!-- fragment --><p>CMake options: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;CLANG_OMP = (ON or OFF) #Whether the compiler uses the OpenMP/Clang compiler</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;CMAKE_BUILD_TYPE = (Release or Debug) #Whether to optimize for performance or for debugging</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;...</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;CUDA_RELEASE = (ON or OFF) #Whether to Optimization for Cuda</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;CUDNN_PATH = /path/to/cudnn/folder #The path to the cuDNN folder you downloaded/copied</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;...</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;PV_USE_CUDA = (ON or OFF) #Whether to use CUDA GPU acceleration</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;PV_USE_CUDNN = True #Whether to use CUDNN</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;PV_USE_OPENMP_THREADS = (ON or OFF) #Whether to use OpenMP threading</div>
</div><!-- fragment --><p>If some of these options do not show up on ccmake, fill the ones you can, press c to configure, and look again for variables Press G to generate when avaliable.</p>
<p>To Test: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;cd ~/workspace/PVSystemTest/BasicSystemTest</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;make -j 8</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;# Change Release to Debug in the line below if you built with CMAKE_BUILD_TYPE = Debug.</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;Release/BasicSystemTest -p input/BasicSystemTest.params -t</div>
</div><!-- fragment --><p>To Test GPU capability:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;cd ~/workspace/PVSystemTest/GPUSystemTest</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;make -j 8</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;# Change Release to Debug in the line below if you built with CMAKE_BUILD_TYPE = Debug.</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;Release/GPUSystemTest -p input/postTest.params -t</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.8 </li>
  </ul>
</div>
</body>
</html>
