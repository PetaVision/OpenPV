// params-unsupervised4x4.pv
//     A two-layer test problem.  Try to learn weights A
//     by minimizing \|x-A^Ta\|^2/2 when x is four-by-four line world
//     and a is a V1-type layer

HyPerCol "column" = {
    nx = 16;
    ny = 16;
    dt = 1;
    numSteps = 1000000;  // number of images times display period
    randomSeed = 1;
    outputPath = "./output/unsupervised16x16/";
};

Movie "Slideshow" = {
    imageListPath = "./input/unsupervised16x16/filenames.txt";
    restart = 0;
    nxScale = 1;
    nyScale = 1;
    nf = 1;
    marginWidth = 0;
    writeStep = 0;
    mirrorBCflag = 0;
    spikingFlag = 0;
    writeNonspikingActivity = 1;

    writeImages = 0;

    displayPeriod = 100;
    jitterFlag = 0;
    randomMovie = 0;
    offsetX = 0;
    offsetY = 0;
};

Retina "Retina" = {
    restart = 0;
    nxScale = 1;
    nyScale = 1;
    nf = 1;
    marginWidth = 0;
    writeStep = 100.0;
    mirrorBCflag = 1;
    spikingFlag = 0;
    writeNonspikingActivity = 1;

    poissonEdgeProb = 1;
    poissonBlankProb = 0;
    burstFreq = 1;
    burstDuration = 40000;

    beginStim = 1;
    endStim = 40000;
};

ANNLayer "AnaRetina" = {
    restart = 0;
    nxScale = 1;
    nyScale = 1;
    nf = 1;
    marginWidth = 0;
    writeStep = 10.0;
    mirrorBCflag = 1;
    spikingFlag = 0;
    writeNonspikingActivity = 1;

    Vrest = 0.0;

    VThresh = -infinity;
    VMax = infinity;
    VMin = -infinity;
};

LogLatWTAGenLayer "V1" = {
    restart = 0;
    nxScale = 0.25;
    nyScale = 0.25;
    nf = 8;
    marginWidth = 1;
    writeStep = 1.0;
    mirrorBCflag = 1;
    spikingFlag = 0;
    writeNonspikingActivity = 1;

    Vrest = 0.0;

    VThresh = 0;
    VMax = infinity;
    VMin = 0;

    relaxation = 0.05; //
    sparsesityTermCoefficient = 1.0; //
};


// Connections

IdentConn "Slideshow to Retina" = {
    preLayerName = "Slideshow";
    postLayerName = "Retina";

    channelCode = 0;

    nxp = 1;
    nyp = 1;
    nfp = 1;

    writeStep = -1;

    delay = 0;

    initFromLastFlag = 0;
};

IdentConn "Retina to AnaRetina" = {
    preLayerName = "Retina";
    postLayerName = "AnaRetina";

    channelCode = 0;

    writeStep = -1;

    delay = 0;

    initFromLastFlag = 0;
};

GenerativeConn "AnaRetina to V1" = {
    preLayerName = "AnaRetina";
    postLayerName = "V1";

    channelCode = 0;

    nxp = 1;
    nyp = 1;
    nfp = 8;

    writeStep = 100;
    writeCompressedWeights = false;

    delay = 0;

    initFromLastFlag = 0;
    randomFlag = 1;
    uniformWeights = 1;
    wMinInit = 0;
    wMaxInit = 1;
    normalize = 1;

    symmetrizeWeights = 0;

    weightUpdatePeriod = 100;
    relaxation = 0.1;
    nonnegConstraintFlag = 1;
    normalizeMethod = 1;
//    normalizeConstant = 2;

//    sumSquaresByKernelValue = 4;
};

FeedbackConn "V1 to AnaRetina Feedback" = {
    originalConnName = "AnaRetina to V1";

    channelCode = 1;

    writeStep = -1;

    delay = 0;

    initFromLastFlag = 0;
};

GenColProbe "Total Energy Probe" = {
    probeOutputFile = "TotalEnergy.txt";
};

LogLatWTAProbe "V1 LogLatWTA" = {
    targetLayer = "V1";
    probeOutputFile = "V1LogLatWTA.txt";
    parentGenColProbe = "Total Energy Probe";
    coeff = 1;
};

L2NormProbe "AnaRetina L2Norm" = {
    targetLayer = "AnaRetina";
    probeOutputFile = "AnaRetinaL2Norm.txt";
    parentGenColProbe = "Total Energy Probe";
    coeff = 1;
};
