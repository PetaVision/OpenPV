//
// ResetStateOnTriggerTest.params
//
// created by peteschultz: Sep 3, 2015
//

// A params file for testing the triggerBehavior = "resetStateOnTrigger".
// A movie layer ("TriggeringLayer") with a display period of 5 is the
// trigger layer.
// A LeakyIntegrator layer ("TestLayer") gets input from a ConstantLayer,
// ("InputLayer") but every five timesteps it triggers to be reset to
// the values in the movie "ResetLayer", which has a display period of 1.
//
// All layers are 8x8x1 so there are 64 neurons.  No layers have margins
// so restricted index and extended index are equal for all neurons.
//
// The value of the InputLayer with global neuron index n is 4*n.
//
// At time t, the resetLayer is all zeros except for a one at the
// neuron whose global index is the same as mod(t,64).
//
// At time t=5n+1, n=0,1,..., the movie layer triggers to reset it
// to the value of resetLayer, and then adds the InputLayer.
// (updateState is still called on trigger steps when using resetStateOnTrigger)
// At time t=5n+2, 5n+3, 5n+4, 5n+5, the InputLayer is added to TestLayer.
//
// Hence at time t=5n+k, with n=0,1,..., and k=1,2,3,4,5,
// most neurons have the value 4*k*(globalIndex),
// except for the neuron whose globalIndex is mod(5n+1,64), whose
// value is one greater.

debugParsing = false;
HyPerCol "column" = {
    startTime                           = 0;
    dt                                  = 1;
    stopTime                            = 100;
    progressInterval                    = 5;
    writeProgressToErr                  = false;
    verifyWrites                        = false;
    outputPath                          = "output/";
    printParamsFilename                 = "pv.params";
    randomSeed                          = 1234567890;
    nx                                  = 8;
    ny                                  = 8;
    nbatch                              = 1;
    initializeFromCheckpointDir         = "";
    checkpointWrite                     = false;
    // checkpointWriteDir
    // checkpointWriteTriggerMode
    // checkpointWriteTimeInterval
    suppressLastOutput                  = false;
    errorOnNotANumber                   = true;
};

MoviePvp "TriggeringLayer" = {
    nxScale                             = 0.25;
    nyScale                             = 0.25;
    nf                                  = 1;
    phase                               = 0;
    mirrorBCflag                        = true;
    triggerLayerName                    = NULL;
    writeStep                           = -1;
    sparseLayer                         = false;
    updateGpu                           = false;
    dataType                            = NULL;
    inputPath                           = "input/blink.pvp";
    offsetAnchor                        = "tl";
    offsetX                             = 0;
    offsetY                             = 0;
    writeImages                         = 0;
    inverseFlag                         = false;
    normalizeLuminanceFlag              = false;
    jitterFlag                          = 0;
    useImageBCflag                      = false;
    padValue                            = 0;
    displayPeriod                       = 5;
    batchMethod                         = "bySpecified";
    start_frame_index                   = [1.000000];
    skip_frame_index                    = [0.000000];
    writeFrameToTimestamp               = true;
    flipOnTimescaleError                = true;
    resetToStartOnLoop                  = false;
};

ConstantLayer "InputLayer" = {
    nxScale                             = 1;
    nyScale                             = 1;
    nf                                  = 1;
    phase                               = 0;
    mirrorBCflag                        = false;
    valueBC                             = 0;
    InitVType                           = "InitVFromFile";
    Vfilename                           = "input/inputLayer.pvp";
    writeStep                           = 1;
    initialWriteTime                    = 100;
    sparseLayer                         = false;
    updateGpu                           = false;
    dataType                            = NULL;
};

MoviePvp "ResetLayer" = {
    nxScale                             = 1;
    nyScale                             = 1;
    nf                                  = 1;
    phase                               = 0;
    mirrorBCflag                        = true;
    triggerLayerName                    = NULL;
    writeStep                           = 1;
    initialWriteTime                    = 0;
    sparseLayer                         = false;
    updateGpu                           = false;
    dataType                            = NULL;
    inputPath                           = "input/dotmovie.pvp";
    offsetAnchor                        = "tl";
    offsetX                             = 0;
    offsetY                             = 0;
    writeImages                         = 0;
    inverseFlag                         = false;
    normalizeLuminanceFlag              = false;
    jitterFlag                          = 0;
    useImageBCflag                      = false;
    padValue                            = 0;
    autoResizeFlag                      = false;
    displayPeriod                       = 1;
    echoFramePathnameFlag               = true;
    batchMethod                         = "bySpecified";
    start_frame_index                   = [1.000000];
    skip_frame_index                    = [0.000000];
    writeFrameToTimestamp               = true;
    flipOnTimescaleError                = true;
    resetToStartOnLoop                  = false;
};

LeakyIntegrator "TestLayer" = {
    nxScale                             = 1;
    nyScale                             = 1;
    nf                                  = 1;
    phase                               = 1;
    mirrorBCflag                        = false;
    valueBC                             = 0;
    InitVType                           = "ZeroV";
    triggerLayerName                    = "TriggeringLayer";
    triggerOffset                       = 0;
    triggerBehavior                     = "resetStateOnTrigger";
    triggerResetLayerName               = "ResetLayer";
    writeStep                           = 1;
    initialWriteTime                    = 0;
    sparseLayer                         = false;
    updateGpu                           = false;
    dataType                            = NULL;
    VThresh                             = -infinity;
    AMin                                = -infinity;
    AMax                                = infinity;
    AShift                              = 0;
    VWidth                              = 0;
    clearGSynInterval                   = 0;
    integrationTime                     = infinity;
};

IdentConn "InputLayerToTestLayer" = {
    preLayerName                        = "InputLayer";
    postLayerName                       = "TestLayer";
    channelCode                         = 0;
    delay                               = [0.000000];
    receiveGpu                          = false;
    initWeightsFile                     = NULL;
    writeStep                           = -1;
    gpuGroupIdx                         = 0;
    preDataLocal                        = false;
    numXLocal                           = 0;
    numYLocal                           = 0;
    numFLocal                           = 0;
};

ResetStateOnTriggerTestProbe "TestProbe" = {
    targetName                          = "TestLayer";
    message                             = "TestProbe";
    textOutputFlag                      = true;
    probeOutputFile                     = "TestProbe.txt";
    triggerLayerName                    = NULL;
};
