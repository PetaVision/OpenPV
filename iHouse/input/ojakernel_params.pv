///////////////////////////////////////////////////////////////////////////////////////////
// Parameter file for testing OjaKernelConn
// DPaiton et SLundquist y PSchultz
///////////////////////////////////////////////////////////////////////////////////////////

debugParsing = false;

HyPerCol "column" = {
   screwUpNonreproduciblyAndNondeterministically = false; // TODO: change the default of this flag from true to false
   nx                           = 32;     // pixel width of input image
   ny                           = 32;     // pixel height of input image
   dt                           = 1.;     // ms // according GK
   
   randomSeed                   = 1020304050.0;   

   numSteps                     = 1000000;  // amount of time steps performed during run-time
   progressStep                 = 20000;  // write output to see progress
   writeProgressToErr           = 0;     // write progress steps to std err
   
   outputPath                   = "output";
   
   filenamesContainLayerNames   = 2;     // stores pvp files as: 0 = layer number/1 = layer number and layer name/2 = layer name
   
   checkpointRead               = true;
   checkpointReadDir            = "checkpoints2";
   checkpointReadDirIndex       = 20000;
   checkpointWrite              = true;
   checkpointWriteDir           = "checkpoints";
   checkpointWriteStepInterval  = 1000;
   deleteOlderCheckpoints       = false;
   // suppressLastOutput           = false;
};


////////////////////////////////////////////////////////////////////////////////
// Layers Layers Layers Layers Layers Layers Layers Layers Layers Layers Layers
// Layers Layers Layers Layers Layers Layers Layers Layers Layers Layers Layers
// Layers Layers Layers Layers Layers Layers Layers Layers Layers Layers Layers
// Layers Layers Layers Layers Layers Layers Layers Layers Layers Layers Layers
// Layers Layers Layers Layers Layers Layers Layers Layers Layers Layers Layers
////////////////////////////////////////////////////////////////////////////////


Patterns "input" = {
   nxScale                       = 1;
   nyScale                       = 1;
   nf                            = 1;
   marginWidth                   = 0;
   restart                       = false;
   
   patternType                   = "DROP";
   dropSpeed                     = -1;   //Radius expands dropSpeed pixles per timestep
   dropSpeedRandomMax            = 0.03;
   dropSpeedRandomMin            = 0.01;
   
   dropPeriod                    = -1;   //-1 for random period, otherwise, number of frames inbetween drops
   dropPeriodRandomMax           = 2000;
   dropPeriodRandomMin           = 1000;
   
   maxValue                      = 0.75;
   minValue                      = 0.25;

   halfNeutral                   = true;
   dropPosition                  = -1;
   dropPositionRandomMax         = 20;
   dropPositionRandomMin         = 5;

   startFrame                    = 0; 
   endFrame                      = -1;
   
   writeImages                   = false;
   // patternsOutputPath           = "output/sourcefiles";
   normalizeLuminanceFlag        = false;
   
   displayPeriod                 = 1;
   writeStep                     = -1;
   useImageBCflag                = false;
   mirrorBCflag                  = false;
   inverseFlag                   = false;
   
   spikingFlag                   = false;
   writeNonspikingActivity       = true;
};

disable = true;
Image "input" = {
   nxScale                       = 1;
   nyScale                       = 1;
   nf                            = 1;
   marginWidth                   = 0;
   mirrorBCflag                  = false;
   restart                       = false;
   
   imagePath                     = "./input/stimulus.png";
   writeImages                   = false;
   offsetX                       = 0;
   offsetY                       = 0;
   
   writeStep                     = 1;
   spikingFlag                   = false;
   writeNonspikingActivity       = false;
   useImageBCflag                = false;
   inverseFlag                   = false;
   normalizeLuminanceFlag        = false;
};
disable = false;


ANNLayer "scaled input" = {
    nxScale                 = 1;
    nyScale                 = 1;
    nf                      = 1;
    marginWidth             = 1;
    mirrorBCflag            = 1;
    spikingFlag             = false;
    writeNonspikingActivity = false;
    writeStep               = -1;

    restart                 = false;
    InitVType               = "ZeroV";

    VThresh                 = -infinity;
    VMax                    = infinity;
    VMin                    = -infinity;
};

Retina "RetinaON" = {
    nxScale       = 1;
    nyScale       = 1;
    nf            = 1;
    marginWidth   = 2;
    restart       = false;
    
    writeStep     = -1;
    mirrorBCflag  = true;
    spikingFlag   = true;  // false (no quotes) is translated to 0

    noiseOnFreq   = 200;   // Hz // Max poisson spiking rate when input is 255
    noiseOffFreq  = 20;    // Hz // Min poisson spiking rate when input is 0

    burstFreq     = 50;    // Hz // Everything coming into the retina should be burstin burstFreq times per sec
    burstDuration = 20;    // ms // Bursts last burstDuration ms

    beginStim     = 0;
    endStim       = -1;
    
    refractoryPeriod    = 0;
    absRefractoryPeriod = 0;
};

Retina "RetinaOFF" = {
    nxScale       = 1;
    nyScale       = 1;
    nf            = 1;
    marginWidth   = 2;
    restart       = false;
    
    writeStep     = -1;
    mirrorBCflag  = true;
    spikingFlag   = true;  // false (no quotes) is translated to 0

    noiseOnFreq   = 200;   // Hz // Max poisson spiking rate when input is 255
    noiseOffFreq  = 20;    // Hz // Min poisson spiking rate when input is 0

    burstFreq     = 50;    // Hz // Everything coming into the retina should be burstin burstFreq times per sec
    burstDuration = 20;    // ms // Bursts last burstDuration ms

    beginStim     = 1;       // Restrict stimulus to a window of time
    endStim       = -1;
        
    refractoryPeriod    = 0;
    absRefractoryPeriod = 0;
};

LCALIFLayer "lcalif" = {
    nxScale                 = 1;        
    nyScale                 = 1;        
    nf                      = 16;           

    tauTHR                  = 4000;       // Timescale for changing adaptive threshold, in milliseconds
    targetRate              = 5;           // Target rate of output spikes in Hertz

    spikingFlag             = 1;           
    marginWidth             = 8;         
    writeStep               = -1;
    mirrorBCflag            = true;        // mirroring boundary conditions
    InitVType               = "ConstantV";
    method                  = "beginning";
    valueV                   = -70.0;
    Vrest                   = -70.0;    
    restart                 = 0.0;         // from graylast
    Vexc                    = 0.0;         // reversal potential 
    Vinh                    = -75.0;       // chloride channel
    VinhB                   = -90.0;       // potassium reversal
    tau                     = 10.0;        // intrinsic leak membrane time constant (max)
    tauE                    = 1.0;         // how long glutamine stays bound
    tauI                    = 5.0;         // how long GABA stays bound
    tauIB                   = 10.0;        // inhibitory potassium channel 
    VthRest                 = -55.0;       // firing threshold 15 mV above rest
    tauVth                  = 10.0;        // 10.0 relative refractory period
    deltaVth                = 5.0;         // jump of threshold when firing
    noiseAmpE               = 1;         // 0.5 1 means conductance is equal to lead conductance  gjk
    noiseAmpI               = 1;         // 0,5 "twice as easy for the membrane capacitance to discharge" gjk
    noiseAmpIB              = 0.0;         // no noise here 
    noiseFreqE              = 250.;        // spontaneous transmitter release/channel openings
    noiseFreqI              = 250.;        // correlation to time step size !!!
    noiseFreqIB             =   0.;        // should be scaled by the time constant - look at LIF model
    Vscale                  = 15.0;        // Scale for the change of dynVthRest. Must be positive; defaults to VthRest - Vrest
};

ANNLayer "lcalif excitatory input" = {
    nxScale                 = 1;
    nyScale                 = 1;
    nf                      = 16;
    marginWidth             = 0;
    mirrorBCflag            = false;
    spikingFlag             = false;
    writeNonspikingActivity = false;
    writeStep               = -1;

    restart                 = false;
    InitVType               = "ZeroV";

    VMax                    = infinity;
    VThresh                 = -infinity;
    VMin                    = -infinity;
};

ANNLayer "lcalif inhibitory input" = {
    nxScale                 = 1;
    nyScale                 = 1;
    nf                      = 16;
    marginWidth             = 0;
    mirrorBCflag            = false;
    spikingFlag             = false;
    writeNonspikingActivity = false;
    writeStep               = -1;

    restart                 = false;
    InitVType               = "ZeroV";

    VMax                    = infinity;
    VThresh                 = -infinity;
    VMin                    = -infinity;
};

////////////////////////////////////////////////////////////////////////////////
// Connections Connections Connections Connections Connections Connections
// Connections Connections Connections Connections Connections Connections
// Connections Connections Connections Connections Connections Connections
// Connections Connections Connections Connections Connections Connections
// Connections Connections Connections Connections Connections Connections
// Connections Connections Connections Connections Connections Connections
////////////////////////////////////////////////////////////////////////////////

KernelConn "input to scaled input" = {
    preLayerName            = "input";
    postLayerName           = "scaled input";
    channelCode             = 0;

    nxp                     = 1;
    nyp                     = 1;
    nfp                     = 1;
    numAxonalArbors         = 1;
    delay                   = 0;

    writeStep               = -1;
    initFromLastFlag        = 0;
    
    weightInitType          = "OneToOneWeights";
    weightInit              = 2.0;
      
    normalize               = false;
    symmetrizeWeights       = false;
    plasticityFlag          = false;
    stochasticReleaseFlag   = false;
    writeCompressedWeights  = true;
    selfFlag                = false;
    shrinkPatches           = false;
    preActivityIsNotRate    = false;
};

KernelConn "ImagetoRetinaONCenter" = {
   preLayerName             = "scaled input";
   postLayerName            = "RetinaON";
   channelCode              = 0;
   nxp                      = 1; 
   nyp                      = 1; 
   nfp                      = 1;
   numAxonalArbors          = 1;
   delay                    = 0;
   
   initFromLastFlag         = 0;  
   writeStep                = -1;
   // initialWriteTime         = 1;

   weightInitType           = "Gauss2DWeight";
   aspect                   = 1;
   sigma                    = 1;
   rMin                     = 0;
   rMax                     = 1;   
   strength                 = 2.66666666667;

   normalize                = true;
   normalizeTotalToPost     = true;
   normalize_max            = false;
   normalize_zero_offset    = false;
   normalize_cutoff         = false;
   symmetrizeWeights        = false;
   plasticityFlag           = false;
   stochasticReleaseFlag    = false;
   writeCompressedWeights   = true;
   selfFlag                 = false;
   shrinkPatches            = false;
   preActivityIsNotRate     = false;
};

KernelConn "ImagetoRetinaONSurround" = {
   preLayerName             = "scaled input";
   postLayerName            = "RetinaON";
   channelCode              = 1;
   nxp                      = 3;
   nyp                      = 3;
   nfp                      = 1;
   numAxonalArbors          = 1;
   delay                    = 0;

   initFromLastFlag         = 0;
   writeStep                = -1;

   weightInitType           = "Gauss2DWeight";
   aspect                   = 1;
   sigma                    = 1;
   rMax                     = 5;
   rMin                     = 0.1;
   strength                 = 2.66666666667;

   normalize                = true;
   normalizeTotalToPost     = true;
   normalize_max            = false;
   normalize_zero_offset    = false;
   normalize_cutoff         = false;
   symmetrizeWeights        = false;
   plasticityFlag           = false;
   stochasticReleaseFlag    = false;
   writeCompressedWeights   = true;
   selfFlag                 = false;
   shrinkPatches            = false;
   preActivityIsNotRate     = false;
};

KernelConn "ImagetoRetinaOFFCenter" = {
   preLayerName             = "scaled input";
   postLayerName            = "RetinaOFF";
   channelCode              = 1;
   nxp                      = 1; 
   nyp                      = 1; 
   nfp                      = 1;
   numAxonalArbors          = 1;
   delay                    = 0;

   initFromLastFlag         = 0;  
   writeStep                = -1;

   weightInitType           = "Gauss2DWeight";
   aspect                   = 1;
   sigma                    = 1;
   rMin                     = 0;
   rMax                     = 1;   
   strength                 = 2.66666666667;

   normalize                = true;
   normalizeTotalToPost     = true;
   normalize_max            = false;
   normalize_zero_offset    = false;
   normalize_cutoff         = false;
   symmetrizeWeights        = false;
   plasticityFlag           = false;
   stochasticReleaseFlag    = false;
   writeCompressedWeights   = true;
   selfFlag                 = false;
   shrinkPatches            = false;
   preActivityIsNotRate     = false;
};


KernelConn "ImagetoRetinaOFFSurround" = {
   preLayerName             = "scaled input";
   postLayerName            = "RetinaOFF";
   channelCode              = 0;
   nxp                      = 3;
   nyp                      = 3;
   nfp                      = 1;
   numAxonalArbors          = 1;
   delay                    = 0;

   initFromLastFlag         = 0;
   writeStep                = -1;

   weightInitType           = "Gauss2DWeight";
   aspect                   = 1;
   sigma                    = 1;
   rMax                     = 5;
   rMin                     = 0.1;
   strength                 = 2.66666666667;

   normalize                = true;
   normalizeTotalToPost     = true;
   normalize_max            = false;
   normalize_zero_offset    = false;
   normalize_cutoff         = false;
   symmetrizeWeights        = false;
   plasticityFlag           = false;
   stochasticReleaseFlag    = false;
   writeCompressedWeights   = true;
   selfFlag                 = false;
   shrinkPatches            = false;
   preActivityIsNotRate     = false;
};

OjaKernelConn "RetinaONtoS1" = {
   preLayerName             = "RetinaON";
   postLayerName            = "lcalif";
   nxp                      = 5;
   nyp                      = 5;
   nfp                      = 16;
   numAxonalArbors          = 1;
   channelCode              = 0;
   delay                    = 0.0;
   
   initFromLastFlag         = 0;  // 1;  /dr/ restart
   
   writeStep                = -1;
   // initialWriteTime         = 0;
   writeCompressedWeights   = false;
   
   normalize                = false;

   combine_dW_with_W_flag   = false;
   selfFlag                 = false;
   preActivityIsNotRate     = false;
   keepKernelsSynchronized  = true;

   weightInitType           = "UniformRandomWeight";
   wMaxInit                 = 0.010;
   wMinInit                 = 0.005;
   
   symmetrizeWeights        = 0;
   
   plasticityFlag           = true;
   shrinkPatches            = false;
   stochasticReleaseFlag    = false;
   initialWeightUpdateTime  = 0.0;
   weightUpdatePeriod       = 1.0;
   
   integrationTime          = 83.33; // Should be a few movie frames in length
   inputTargetRate          = 5.0;   // Between 1 and 10 Hz
   outputTargetRate         = 5.0;   // Between 1 and 10 Hz
   learningTime             = 40000;   // Timescale for change in weights, in seconds
};


OjaKernelConn "RetinaOFFtoS1" = {
   preLayerName             = "RetinaOFF";
   postLayerName            = "lcalif";
   nxp                      = 5;
   nyp                      = 5;
   nfp                      = 16;
   numAxonalArbors          = 1;
   channelCode              = 0;
   delay                    = 0.0;
   
   initFromLastFlag         = 0;  // 1;  /dr/ restart

   writeStep                = -1;
   // initialWriteTime         = 0;
   writeCompressedWeights   = false;
   
   normalize                = false;
   
   combine_dW_with_W_flag   = false;
   selfFlag                 = false;
   preActivityIsNotRate     = false;
   keepKernelsSynchronized  = true;

   weightInitType           = "UniformRandomWeight";
   wMaxInit                 = 0.010;
   wMinInit                 = 0.005;
   
   symmetrizeWeights        = 0;
   
   plasticityFlag           = true;
   shrinkPatches            = false;
   stochasticReleaseFlag    = false;
   initialWeightUpdateTime  = 0.0;
   weightUpdatePeriod       = 1.0;
   
   integrationTime          = 83.33; // Should be a few movie frames in length
   inputTargetRate          = 5.0;   // Between 1 and 10 Hz
   outputTargetRate         = 5.0;   // Between 1 and 10 Hz
   learningTime             = 40000;   // Timescale for change in weights, in seconds
};

LCALIFLateralKernelConn "Lateral Inhibition" = {
   preLayerName             = "lcalif";
   postLayerName            = "lcalif";
   nxp                      = 9;
   nyp                      = 9;
   nfp                      = 16;
   numAxonalArbors          = 1;
   channelCode              = 1;
   delay                    = 0.0;

   initFromLastFlag         = false;
   
   writeStep                = -1;
   // initialWriteTime         = 0.0;
   
   plasticityFlag           = true;
   weightUpdatePeriod       = 1;
   initialWeightUpdateTime  = 0;
   stochasticReleaseFlag    = false;
   preActivityIsNotRate     = false;
   writeCompressedWeights   = false;
   selfFlag                 = false;
   shrinkPatches            = false;
   combine_dW_with_W_flag   = false;
   symmetrizeWeights        = false;
   keepKernelsSynchronized  = true;
   
   weightInitType           = "UniformWeight";
   weightInit               = 0.0;
   
   normalize                = false;

   integrationTimeConstant  = 200;
   inhibitionTimeConstant   = 16000;
   targetRate               = 5;
};

CloneKernelConn "On clone" = {
    preLayerName            = "RetinaON";
    postLayerName           = "lcalif excitatory input";
    
    originalConnName        = "RetinaONtoS1";

    channelCode             = 0;

    writeStep               = -1;
    writeCompressedWeights  = false;

    delay                   = 0;
    
    stochasticReleaseFlag   = false;
    preActivityIsNotRate    = false;
    selfFlag                = false;
};

CloneKernelConn "Off clone" = {
    preLayerName            = "RetinaOFF";
    postLayerName           = "lcalif excitatory input";
    
    originalConnName        = "RetinaONtoS1";

    channelCode             = 0;

    writeStep               = -1;
    writeCompressedWeights  = false;

    delay                   = 0;
    
    stochasticReleaseFlag   = false;
    preActivityIsNotRate    = false;
    selfFlag                = false;
};

CloneKernelConn "Lateral clone" = {
    preLayerName            = "lcalif";
    postLayerName           = "lcalif inhibitory input";
    
    originalConnName        = "Lateral Inhibition";

    channelCode             = 0;

    writeStep               = -1;
    writeCompressedWeights  = false;

    delay                   = 0;
    
    stochasticReleaseFlag   = false;
    preActivityIsNotRate    = false;
    selfFlag                = false;
};

PointProbe "Input Probe" = {
   targetLayer = "scaled input";
   probeOutputFile = "ScaledInput_08_17_00.txt";
   message = "Scaled Input Probe              ";
   xLoc = 8;
   yLoc = 17;
   fLoc = 0;
};

PointProbe "RetinaON Probe" = {
   targetLayer = "RetinaON";
   probeOutputFile = "RetinaON_08_17_00.txt";
   message = "RetinaON Probe                  ";
   xLoc = 8;
   yLoc = 17;
   fLoc = 0;
};

PointProbe "RetinaOFF Probe" = {
   targetLayer = "RetinaOFF";
   probeOutputFile = "RetinaOFF_08_17_00.txt";
   message = "RetinaON Probe                  ";
   xLoc = 8;
   yLoc = 17;
   fLoc = 0;
};

PointLCALIFProbe "LCALIF Probe" = {
   targetLayer = "lcalif";
   probeOutputFile = "LCALIF_08_17_12.txt";
   message = "LCALIF Probe                    ";
   xLoc = 8;
   yLoc = 17;
   fLoc = 12;
};

PointProbe "LCALIF GSynExc Probe" = {
   targetLayer = "lcalif excitatory input";
   probeOutputFile = "LCALIF_exc_08_17_12.txt";
   message = "LCALIF Excitatory Probe         ";
   xLoc = 8;
   yLoc = 17;
   fLoc = 12;
};

PointProbe "LCALIF GSynInh Probe" = {
   targetLayer = "lcalif inhibitory input";
   probeOutputFile = "LCALIF_inh_08_17_12.txt";
   message = "LCALIF Inhibitory Probe         ";
   xLoc = 8;
   yLoc = 17;
   fLoc = 12;
};
